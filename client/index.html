<!DOCTYPE HTML>
<!--
	Solid State by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<!--
    Copyright (C) 2022  Schmuel Odradek
    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation; version 3.
    DSBLSP is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.
    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.

    This product is a WIP. There are still a lot things to be done.
    The current version of the software is not meant to be already daily-driven
    in schools or companies.

    TODO: 
    - Master relative positioning on screen (Maybe Font mastering?)
    - Design account System (login and password) to prevent abuse

-->
<html>
	<head>
		<title>DSB</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="client/assets/css/main.css" />
		<noscript><link rel="stylesheet" href="client/assets/css/noscript.css" /></noscript>
	</head>
	<body class="is-preload">

		<!-- Page Wrapper -->
			<div id="page-wrapper">


				<!-- Wrapper -->
					<section id="wrapper">
						<header>
							<div class="inner">
								<h2>Welcome</h2>
								<p>To the back-end of the DSB software. You may now post something to the DSB</p>
							</div>
						</header>

						<!-- Content -->
							<div class="wrapper">
								<div class="inner">

									<!--<h3 class="major">Lorem ipsum dolor</h3>
									<p>Morbi mattis mi consectetur tortor elementum, varius pellentesque velit convallis. Aenean tincidunt lectus auctor mauris maximus, ac scelerisque ipsum tempor. Duis vulputate ex et ex tincidunt, quis lacinia velit aliquet. Duis non efficitur nisi, id malesuada justo. Maecenas sagittis felis ac sagittis semper. Curabitur purus leo donec vel dolor at arcu tincidunt bibendum. Interdum et malesuada fames ac ante ipsum primis in faucibus. Fusce ut aliquet justo. Donec id neque ipsum. Integer eget ultricies odio. Nam vel ex a orci fringilla tincidunt. Aliquam eleifend ligula non velit accumsan cursus. Etiam ut gravida sapien.</p>

									<p>Vestibulum ultrices risus velit, sit amet blandit massa auctor sit amet. Sed eu lectus sem. Phasellus in odio at ipsum porttitor mollis id vel diam. Praesent sit amet posuere risus, eu faucibus lectus. Vivamus ex ligula, tempus pulvinar ipsum in, auctor porta quam. Proin nec commodo, vel scelerisque nisi scelerisque. Suspendisse id quam vel tortor tincidunt suscipit. Nullam auctor orci eu dolor consectetur, interdum ullamcorper ante tincidunt. Mauris felis nec felis elementum varius.</p>

									<h3 class="major">Vitae phasellus</h3>
									<p>Cras mattis ante fermentum, malesuada neque vitae, eleifend erat. Phasellus non pulvinar erat. Fusce tincidunt, nisl eget mattis egestas, purus ipsum consequat orci, sit amet lobortis lorem lacus in tellus. Sed ac elementum arcu. Quisque placerat auctor laoreet.</p>

									<section class="features">
										<article>
											<a href="#" class="image"><img src="images/pic04.jpg" alt="" /></a>
											<h3 class="major">Sed feugiat lorem</h3>
											<p>Lorem ipsum dolor sit amet, consectetur adipiscing vehicula id nulla dignissim dapibus ultrices.</p>
											<a href="#" class="special">Learn more</a>
										</article>
										<article>
											<a href="#" class="image"><img src="images/pic05.jpg" alt="" /></a>
											<h3 class="major">Nisl placerat</h3>
											<p>Lorem ipsum dolor sit amet, consectetur adipiscing vehicula id nulla dignissim dapibus ultrices.</p>
											<a href="#" class="special">Learn more</a>
										</article>
									</section>-->
									<h3 class="major">Live screen</h3>
									<div id="screen"></div>
									<textarea id="msg" type="" cols="65" rows="5" placeholder="Type message"></textarea>
									<button type="submit" onclick="sendDate()">Send</button>
									<br><br>
									<button type="reset" onclick="erease()">Erease</button>
									<button type="reset" onclick="del()">Delete last</button>
									<button type="submit" onclick="testChange()">TEST</button>

								</div>
							</div>

					</section>

				<!-- Footer -->
					<section id="footer">
						<div class="inner">
							<!--<h2 class="major">If you have any Questions</h2>
							<p><br>If you have any questions, you may feel free to contact @SchmueI on Github.</p>-->
							<ul class="copyright">
								<li>&copy; Schmuel Odradek 2022. This Software is released under the GPL 3.0</li><li>Software and DSB Design: <a href="https://www.schmuel.net/" target="_BLANK">Schmuel</a></li><li>Interface-Design: <a target="_BLANK" href="http://html5up.net">HTML5 UP</a></li>
							</ul>
						</div>
					</section>

			</div>

		<!-- Scripts -->
			<script src="client/assets/js/jquery.min.js"></script>
			<script src="client/assets/js/jquery.scrollex.min.js"></script>
			<script src="client/assets/js/browser.min.js"></script>
			<script src="client/assets/js/breakpoints.min.js"></script>
			<script src="client/assets/js/util.js"></script>
			<script src="client/assets/js/main.js"></script>
			<script src="/socket.io/socket.io.js"></script>
			<script src="client/js/raphael/raphael.js"></script>
			<script>
					
				var width = document.getElementById('screen').offsetWidth;
				var socket = io();
				var paper = Raphael(document.getElementById("screen"), width, width*0.5625);

				var movingElem = false;
				
				var staticTimeTable = [];
				socket.on("timetable", function(data){
					for (var i = 0; i<data.length; i++){
						staticTimeTable[i]=data[i];
					}
					timetable(0.75, 0.15, 0.1, 0.06);
				});

				var sendDate = function(){
				
					socket.emit("date",{
						text:document.getElementById("msg").value,
						x:0.5,
						y:0.25
					});

				}

				var erease = function(){

					socket.emit("erease", {
						erease:"all"
					});

				}

				var del = function(){

					socket.emit("erease",{
						erease:"last"
					});

				}

				var testChange = function(){
					socket.emit("ChangeTime",{
						day: 3,
						raw1: "",
						raw2: "14-16, Test",
						raw3: "14-16, Test",
						raw4: "14-16, Test",
						raw5: "14-16, Test",
						raw6: "14-16, Test",
						raw7: "14-16, Test"
					})
				}

				/*
					This section defines the way how the text moves
				*/

				move_start = function () {
					//storing original coordinates
					this.ox = this.attr('x');
					this.oy = this.attr('y');
					this.attr({opacity: 0.5});
					movingElem = true;
				};

				//visually change the text when it is being moved
				move_drag = function (dx, dy, x, y) {
					//move will be called with dx and dy
					this.attr({x: this.ox + dx, y: this.oy + dy});
					socket.emit("move",{
						x: (this.ox + dx)/paper.width,
						y: (this.oy + dy)/paper.height,
						id: this.id
					});
					
				};

				//when the user lets go of the mouse button, reset the square's properties
				move_up = function () {
					//restoring the visual state
					this.attr({opacity: 1});
					movingElem = false;
				};

				rem_elem = function(){
					socket.emit("erease",{
						erease: "spec",
						id: this.id
					});
				}

				var elements = [];
				socket.on("recentData",function(data){
					/*
						This section is about aligning the elements on the paper correctly.
						It sets the preferences of the background and style elements.
						The for-loop iterates thru every Element of the received Dataset
						and prints it to the Screen.

						TODO: Only refresh the Text. Background and layout could be static to improve performance.
					*/
					//paper.clear();
					
					if (!movingElem){
						for(var i = 0; i < elements.length; i++){
							elements[i].remove();
						}

						elements = [];

						for (var i = 0; i<data.length; i++){
							x=data[i].x*paper.width;
							y=data[i].y*paper.height;
							
							elements.push({
								text: data[i].text,
								x: x,
								y: y
							});
							
						}
						for(var i = 0; i < elements.length; i++) {
							//extract the positional data from the json array
							var px = elements[i].x;
							var py = elements[i].y;
							
							//we need to make sure that the values are numerical for calculations later
							px = parseInt(px);
							py = parseInt(py);

							//deal with this individual text, position it and show a status based on color
							elements[i] = paper.text(px, py, elements[i].text).attr({
								fill: "white",
								font: "Arial",
								"font-size": Math.floor(0.033*paper.height),
								"text-anchor": "start",
								cursor: "grabbing",
							});
							elements[i].id = i
							
							//define relations and functions for moving and positioning
							//move the text
							elements[i].drag(move_drag, move_start, move_up);
							elements[i].dblclick(rem_elem)
						}
					}
				});

				socket.on("serverLog", function(data){
					console.log(data.log);
				});

				var init = function() {
					var bg = paper.rect(0, 0, window.innerWidth, window.innerHeight);
					var siteBarWhite = paper.rect(0.98*paper.width, 0, 0.01*paper.width, paper.height);
					var siteBarViolet = paper.rect(0.99*paper.width, 0, 0.01*paper.width, paper.height);
					var title = paper.text(0.5*paper.width, 0.047*paper.height, "Information").attr({
						fill: "white",
						font: "Arial",
						"font-size": Math.floor(0.08*paper.height),
						"font-family": "bold"
					});
					bg.attr({
						fill: "black"
					});
					siteBarWhite.attr({
						fill: "white",
						stroke: "white"
					});
					siteBarViolet.attr({
						fill: "#571c5b",
						stroke: "#571c5b"
					});
					clock(0.85, 0.06, 0.03);
				}


				var clock = function(xrel, yrel, rrel){
					xpos=xrel*paper.width
					ypos=yrel*paper.height
					r=rrel*paper.width

					var c1 = paper.circle(xpos, ypos , r).attr({"stroke":"#fff", "stroke-width":2});
					var c2 = paper.circle(xpos, ypos, r*0.03334).attr({"fill":"#571c5b"});
					var sMark = paper.path("M "+ xpos + " " + ypos+" m 0 "+(-r+(0.0666*r))+" l 0 "+(-0.0666*r)).attr({"stroke":"#fff", "stroke-width":2});
					sMark.clone().attr({transform:"r30 "+ xpos + " " + ypos});
					sMark.clone().attr({transform:"r60 "+ xpos + " " + ypos});
					sMark.clone().attr({transform:"r120 "+ xpos + " " + ypos});
					sMark.clone().attr({transform:"r150 "+ xpos + " " + ypos});
					sMark.clone().attr({transform:"r210 "+ xpos + " " + ypos});
					sMark.clone().attr({transform:"r240 "+ xpos + " " + ypos});
					sMark.clone().attr({transform:"r300 "+ xpos + " " + ypos});
					sMark.clone().attr({transform:"r330 "+ xpos + " " + ypos});
					var lMark = paper.path("M "+ xpos + " " + ypos+" m 0 "+(-r+(0.133333*r))+" l 0 "+(-0.133333*r)).attr({"stroke":"#571c5b",  "stroke-width":4});
					lMark.clone().attr({transform:"r90 "+ xpos + " " + ypos});
					lMark.clone().attr({transform:"r180 "+ xpos + " " + ypos});
					lMark.clone().attr({transform:"r270 "+ xpos + " " + ypos});
					lMark.clone().attr({transform:"r360 "+ xpos + " " + ypos});
					var d = new Date();
					var hourAngle = (d.getHours() * 60 + d.getMinutes())/2, minAngle = (d.getMinutes() * 6), secAngle = (d.getSeconds() * 6);
					var secHand = paper.path("M "+ xpos + " " + ypos+", l 0"+(r*0.73333333333*-1)+", M "+ xpos + " " + ypos+", l 0" + (0.1*r)).attr({"stroke":"#571c5b", "stroke-width":2});
					var minHand = paper.path("M "+ xpos + " " + ypos+", l 0 "+(r*0.8*-1)).attr({"stroke":"#fff", 'stroke-width':2}).transform("r" + minAngle + " "+ xpos + " " + ypos);
					var hourHand = paper.path("M "+ xpos + " " + ypos+", l 0 "+(r*0.53333*-1)).attr({"stroke":"#fff", 'stroke-width':3, 'stroke-linecap':'round'}).transform("r" + hourAngle + " "+ xpos + " " + ypos);
					var secAnim = Raphael.animation({transform: "r360 "+ xpos + " " + ypos}, 60000).repeat(Infinity);
					var minAnim = Raphael.animation({transform: "r360 "+ xpos + " " + ypos}, 3600000).repeat(Infinity);
					var hourAnim = Raphael.animation({transform: "r360 "+ xpos + " " + ypos}, 43200000).repeat(Infinity);
					secHand.animate(secAnim); 
					minHand.animate(minAnim);
					hourHand.animate(hourAnim);
				}

				tableElements=[]
				var timetable = function(x, y, width, height){
					console.log("TIMETABLE")

					day = new Date().getDay();
					x = x*paper.width;
					y = y*paper.height;
					width = width*paper.width;
					height = height*paper.height;

					for(var i = 0; i < tableElements.length; i++){
						tableElements[i].remove();
					}

					WriteTableRow(x,y,width*2,height,paper,staticTimeTable[day].day);
					y= y+height;
					WriteTableRow(x,y,width,height,paper,staticTimeTable[day].raw1);
					y= y+height;
					WriteTableRow(x,y,width,height,paper,staticTimeTable[day].raw2);
					y= y+height;
					WriteTableRow(x,y,width,height,paper,staticTimeTable[day].raw3);
					y= y+height;
					WriteTableRow(x,y,width,height,paper,staticTimeTable[day].raw4);
					y= y+height;
					WriteTableRow(x,y,width,height,paper,staticTimeTable[day].raw5);
					y= y+height;
					WriteTableRow(x,y,width,height,paper,staticTimeTable[day].raw6);
					y= y+height;
					WriteTableRow(x,y,width,height,paper,staticTimeTable[day].raw7);
					y= y+height;


					function WriteTableRow(x,y,width,height,paper,TDdata){
						var TD = TDdata.split(",");
						for (j=0; j<TD.length; j++) {
							var rect = paper.rect(x,y,width,height).attr({"stroke":"#571c5b"});
							tableElements.push(
								paper.text(x+width/2, y+height/2, TD[j]).attr({
									"fill":"#fff",
									"font-size": Math.floor(0.024*paper.height)
								})
							);
							x = x + width;
						}
					}
            	}

            	init(); 
			
			</script>
		<!--Scripts-->

	</body>
</html>
