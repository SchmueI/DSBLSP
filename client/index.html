<!--
    Copyright (C) 2022  Schmuel Odradek
    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation; version 3.
    DSBLSP is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.
    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.

    This product is a WIP. There are still a lot things to be done.
    The current version of the software is not meant to be already daily-driven
    in schools or companies.

    TODO: 
    - Master relative positioning on screen (Maybe Font mastering?)
    - Design account System (login and password) to prevent abuse
    - Set Design standards

-->

<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
        <title>Digitales Schwarzes Brett</title>
    </head>

    <body>
        <h1>Live Information Screen</h1>
        <<canvas id="ctx" width="800" height="450" style="border:1px solid #000; background-color: #000"></canvas>
        <div id="input" style="float:left">
            <h2>Input</h2>
            <textarea id="msg" type="" cols="65" rows="5" placeholder="Type message"></textarea>
            <button type="submit" onclick="sendDate()">Send</button>
            <br>
            <button type="reset" onclick="erease()">Erease</button>
            <button type="reset" onclick="del()">Delete last</button>
        </div>


        <!--Scripts down here-->
        <script src="/socket.io/socket.io.js"></script>
        <script src="client/js/raphael/raphael.js"></script>
        <script>
            /*
                Get ctx informations
            */
            var ctx = document.getElementById("ctx").
            getContext("2d")
            ctx.font = 0.033*ctx.canvas.height+"px Arial"
            
            var DATA_LIST = {};
        
            var socket = io();

            var sendDate = function(){
              
                socket.emit("date",{
                    text:document.getElementById("msg").value,
                    x:0.5,
                    y:0.25
                });

            }

            var erease = function(){

                socket.emit("erease", {
                    erease:"all"
                });

            }

            var del = function(){

                socket.emit("erease",{
                    erease:"last"
                });

            }

            socket.on("recentData",function(data){
                ctx.clearRect(0,0,document.getElementById("ctx").width,document.getElementById("ctx").height);
                ctx.fillStyle = "#fff";
                ctx.fillRect(0.98*ctx.canvas.width, 0, 0.01*ctx.canvas.width, ctx.canvas.height);
                ctx.fillStyle = "#571c5b";
                ctx.fillRect(0.99*ctx.canvas.width, 0, 0.01*ctx.canvas.width, ctx.canvas.height);

                ctx.fillStyle = "#fff";
                for (var i = 0; i<data.length; i++){

                    x=data[i].x*ctx.canvas.width;
                    y=data[i].y*ctx.canvas.height;

                    var lineHeight = ctx.measureText("M").width * 1.2;
                    var lines = data[i].text.split("\n");
                    for (var j = 0; j < lines.length; ++j) {
                        ctx.fillText(lines[j], x, y);
                        y += lineHeight;
                    }
                }
            });

            socket.on("serverLog", function(data){
                console.log(data.log);
            });
        
        </script>

    </body>
</html>