<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
        <title>Digitales Schwarzes Brett</title>
    </head>

    <body>
        <h1>Live Information Screen</h1>
        <canvas id="ctx" width="1600" height="900" style="border:1px solid #000; background-color: #aaa"></canvas>
        <div id="input" style="float:left">
            <h2>Input</h2>
            <textarea id="msg" type="" cols="40" rows="5" placeholder="Type message"></textarea>
            <button type="submit" onclick="sendDate()">Send</button>
            <br>
            <button type="reset" onclick="erease()">Erease</button>
            <button type="reset" onclick="del()">Delete last</button>
        </div>


        <!--Scripts down here-->
        <script src="/socket.io/socket.io.js"></script>
        <script>
            /*
                Get ctx informations
            */
            var ctx = document.getElementById("ctx").
            getContext("2d")
            ctx.font = "30px Arial"
        
            var socket = io();

            var sendDate = function(){
              
                socket.emit("date",{
                    text:document.getElementById("msg").value,
                    x:Math.floor(document.getElementById("ctx").width*Math.random()),
                    y:Math.floor(document.getElementById("ctx").height*Math.random())
                });

            }

            var erease = function(){

                socket.emit("erease", {
                    erease:"all"
                });

            }

            var del = function(){

                socket.emit("erease",{
                    erease:"last"
                });

            }

            socket.on("recentData",function(data){
                ctx.clearRect(0,0,document.getElementById("ctx").width,document.getElementById("ctx").height);
                for (var i = 0; i<data.length; i++){

                    var lineHeight = ctx.measureText("M").width * 1.2;
                    var lines = data[i].text.split("\n");
                    for (var j = 0; j < lines.length; ++j) {
                        ctx.fillText(lines[j], data[i].x, data[i].y);
                        data[i].y += lineHeight;
                    }
                }
            });

            socket.on("serverLog", function(data){
                console.log(data.log);
            });
        
        </script>

    </body>
</html>